<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Sa'ati - Work Hours Tracker</title>

  <!-- UI libs -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

  <style>
    :root{--bg-color-light:#f0f4f8;--bg-color-dark:#0f172a;--glass-bg-light:#ffffff;--glass-bg-dark:#1e293b;--glass-border-light:#e2e8f0;--glass-border-dark:#334155;--shadow-color-light:rgba(99,102,241,.15);--shadow-color-dark:rgba(0,0,0,.3)}
    body{font-family:Inter,"Helvetica Neue",Arial,sans-serif;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;color:#1f2937;background-color:var(--bg-color-light);overflow:hidden}
    html.dark body{color:#e5e7eb;background-color:var(--bg-color-dark)}
    body::before{content:'';position:fixed;inset:0;z-index:-1;background:linear-gradient(45deg,#818cf8,#a78bfa,#f472b6,#60a5fa,#34d399);background-size:400% 400%;animation:gradient-animation 25s ease infinite;opacity:.15}
    html.dark body::before{opacity:.2}
    html[lang="ar"] body,html[dir="rtl"] body{font-family:Cairo,sans-serif}
    *{transition:background-color .3s ease,color .3s ease,border-color .3s ease,box-shadow .3s ease}
    @keyframes gradient-animation{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}
    .smooth-scroll{overflow-y:auto;height:100vh;scroll-behavior:smooth}
    .smooth-scroll::-webkit-scrollbar{width:8px}
    .smooth-scroll::-webkit-scrollbar-track{background:transparent}
    .smooth-scroll::-webkit-scrollbar-thumb{background-color:rgba(0,0,0,.2);border-radius:10px;border:2px solid transparent;background-clip:content-box}
    html.dark .smooth-scroll::-webkit-scrollbar-thumb{background-color:rgba(255,255,255,.2)}
  </style>

  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          fontFamily: { sans: ['Inter','sans-serif'], cairo: ['Cairo','sans-serif'] }
        }
      }
    }
  </script>

  <!-- ⚠️ تم حذف importmap غير الموثوق (aistudiocdn) لحل تنبيه CodeQL ومشاكل النشر -->
</head>
<body>
  <div id="root"></div>

  <!-- ✅ Firebase SDKs (موثوقة من gstatic) -->
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>

  <!-- ✅ Firebase init + زر اختبار تسجيل الدخول -->
  <script type="module">
    // استخدم المسار الصحيح حيث وضعت الملف داخل src
    import { firebaseConfig } from './src/firebaseConfig.js';

    try {
      if (firebase.apps.length === 0) {
        firebase.initializeApp(firebaseConfig);
      }
    } catch (e) {
      console.error("Firebase initialization error", e);
    }

    const auth = firebase.auth();
    const provider = new firebase.auth.GoogleAuthProvider();

    // عناصر اختبار بسيطة لا تؤثر على React
    const bar = document.createElement('div');
    bar.style = 'position:fixed;bottom:16px;right:16px;display:flex;gap:8px;z-index:9999';
    const loginBtn = document.createElement('button');
    loginBtn.textContent = 'Google Login';
    loginBtn.className = 'px-3 py-2 rounded-md bg-blue-600 text-white shadow hover:bg-blue-700';

    const logoutBtn = document.createElement('button');
    logoutBtn.textContent = 'Logout';
    logoutBtn.className = 'px-3 py-2 rounded-md bg-slate-600 text-white shadow hover:bg-slate-700 hidden';

    bar.appendChild(loginBtn);
    bar.appendChild(logoutBtn);
    document.body.appendChild(bar);

    auth.onAuthStateChanged((user) => {
      if (user) {
        loginBtn.classList.add('hidden');
        logoutBtn.classList.remove('hidden');
        console.log('Signed in:', user.email);
      } else {
        loginBtn.classList.remove('hidden');
        logoutBtn.classList.add('hidden');
        console.log('No user signed in');
      }
    });

    loginBtn.onclick = async () => {
      try {
        await auth.signInWithPopup(provider);
        alert('تم تسجيل الدخول ✅');
      } catch (err) {
        console.warn('Popup failed; trying redirect...', err);
        try {
          await auth.signInWithRedirect(provider);
        } catch (e2) {
          console.error('Redirect failed', e2);
          alert('فشل تسجيل الدخول — تأكد من Authorized domains وإعداد OAuth');
        }
      }
    };

    logoutBtn.onclick = () => auth.signOut();
  </script>

  <!-- تطبيقك (React/Vite) -->
  <script type="module" src="/index.tsx"></script>
</body>
</html>
